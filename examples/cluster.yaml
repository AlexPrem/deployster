plugs:
  kube:
    path: {{ kube_path }}
    read_only: false

resources:

  test-cluster:
    type: infolinks/deployster-gcp-gke-cluster:{{ deployster_version }}
    dependencies:
      project: test-project
    config:
      zone: {{ zone }}
      name: test
      description: Test cluster.
      version: 1.8.2-gke.0
      node_pools:
        - name: default
          min_size: 1
          max_size: 1
          preemptible: true

  cluster-admin-role:
    type: infolinks/deployster-k8s-rbac-role:{{ deployster_version }}
    readonly: true
    dependencies:
      cluster: test-cluster
    config:
      manifest:
        metadata:
          name: cluster-admin
        rules:
          - apiGroups: ['*']
            resources: ['*']
            verbs: ['*']
          - nonResourceURLs: ['*']
            verbs: ['*']

  test-administrator-user:
    type: infolinks/deployster-k8s-rbac-user:{{ deployster_version }}
    config:
      name: {{ test_admin_user }}

  test-administrator-binding:
    type: infolinks/deployster-k8s-rbac-role-binding:{{ deployster_version }}
    dependencies:
      role: cluster-admin-role
      user: test-administrator-user
    config:
      manifest:
        metadata:
          name: test-administrator-binding
